<!DOCTYPE html>
<html lang="en">
  <head>
    <title>Photography Gallery</title>
    <%- include('partials/head') %>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css"
      rel="stylesheet"
      crossorigin="anonymous"
    />
    <style>
      form .form-select {
        background-color: #f8f9fa; /* Light gray background */
        border-radius: 5px; /* Rounded corners */
        border: 1px solid #ced4da; /* Subtle border */
        padding: 0.375rem 1.75rem 0.375rem 0.75rem; /* Spacing inside */
        font-size: 1rem; /* Font size */
        color: #495057; /* Text color */
      }

      form .form-select:focus {
        border-color: #6c757d; /* Darker border on focus */
        box-shadow: 0 0 0 0.2rem rgba(108, 117, 125, 0.25); /* Focus shadow */
      }
      .sidebar {
        position: fixed;
        top: 0;
        right: -100%;
        width: 100%;
        max-width: 40%;
        height: 100%;
        background: white;
        padding: 2rem;
        transition: right 0.3s ease;
        box-shadow: -5px 0 15px rgba(0, 0, 0, 0.1);
        overflow-y: auto;
        z-index: 1050;
      }

      .sidebar.active {
        right: 0;
      }

      .overlay {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.5);
        z-index: 1040;
      }

      .overlay.active {
        display: block;
      }
    </style>
  </head>
  <body class="animsition">
    <%- include('partials/navbar') %>

    <!-- Hero Section -->
    <header
      class="bg-gradient text-center py-5 mb-4 h-50"
      style="
        background: linear-gradient(
          135deg,
          #ffffff 0%,
          #cdcdcd 100%
        ) !important;
        color: black;
      "
    >
      <div class="container">
        <h1 class="display-4 fw-bold mb-3">Photography Gallery</h1>
        <p class="lead mb-4">
          Share your best shots with the photography community
        </p>
        <button class="btn btn-secondary btn-lg" id="openSidebar">
          <i class="fas fa-camera me-2"></i> Submit Your Art
        </button>
      </div>
    </header>

    <!-- Main Content -->
    <main>
      <div class="container">
        <% if(arts) {%>
        <div class="row row-cols-1 row-cols-md-3 g-4">
          <% arts.forEach((art) => { %>
          <div
            class="col-12 col-sm-12 col-md-12 col-lg-12 col-xl-12 col-xxl-6 mb-5"
          >
            <div class="card">
              <img
                src="<%= art.image %>"
                class="card-img-top"
                alt="Photo of a beautiful landscape"
              />
              <div class="card-body">
                <h5 class="card-title"><%= art.title %></h5>
                <p class="card-text small">
                  Captured by
                  <strong
                    ><%= art.userId.firstName +" "+ art.userId.lastName %></strong
                  >
                </p>
                <p class="card-text"><%= art.description %></p>
                <ul class="list-unstyled small">
                  <li><strong>Camera:</strong> <%= art.camera %></li>
                  <li><strong>Lens:</strong> <%= art.lens %></li>
                  <li><strong>Aperture:</strong> <%= art.aperture %></li>
                  <li><strong>ISO:</strong> <%= art.iso %></li>
                  <li>
                    <strong>Shutter Speed:</strong> <%= art.sutter_speed %>
                  </li>
                </ul>
                <div class="d-flex align-items-center mt-3 text-end">
                  <button class="btn btn-outline-dark btn-sm me-2">
                    <i class="far fa-thumbs-up"></i> Like
                  </button>
                </div>
              </div>
            </div>
          </div>
          <%})%>
        </div>
         <%} else {%>
           <h4>Gallery emty</h4>
          <%}%>
      </div>
    </main>

    <!-- Overlay -->
    <div class="overlay" id="overlay"></div>

    <!-- Sidebar Form -->
    <div class="sidebar" id="sidebar">
      <div class="d-flex justify-content-between align-items-center mb-4">
        <h5>Submit Your Artwork</h5>
        <button
          class="btn btn-link p-0 fs-1 text-dark text-decoration-none"
          id="closeSidebar"
        >
          &times;
        </button>
      </div>
      <form id="artSubmitForm" enctype="multipart/form-data" novalidate>
        <div class="mb-3">
          <label for="photoUpload" class="form-label">Upload Photo</label>
          <input
            type="file"
            class="form-control"
            id="photoUpload"
            name="image"
            accept="image/*"
            required
          />
          <div class="invalid-feedback">Please select an image to upload.</div>
        </div>
        <img
          id="imagePreview"
          class="img-fluid rounded-3"
          style="
            max-width: 100%;
            max-height: 200px;
            margin-top: 10px;
            display: none;
          "
          alt="Preview"
        />

        <div class="mb-3">
          <label for="photoTitle" class="form-label">Title</label>
          <input
            type="text"
            name="title"
            class="form-control"
            id="photoTitle"
            placeholder="Enter a title for your photo"
            required
          />
          <div class="invalid-feedback">Please enter a title.</div>
        </div>

        <div class="mb-3">
          <label for="photoDescription" class="form-label">Description</label>
          <textarea
            name="description"
            class="form-control"
            id="photoDescription"
            rows="3"
            placeholder="Tell us about your photo"
            required
          ></textarea>
          <div class="invalid-feedback">Please provide a description.</div>
        </div>

        <!-- Additional form fields for camera, lens, etc. -->
        <div class="mb-3">
          <label for="cameraModel" class="form-label">Camera Model</label>
          <input
            name="camera"
            type="text"
            class="form-control"
            id="cameraModel"
            placeholder="Enter your camera model"
            required
          />
          <div class="invalid-feedback">Please enter a camera model.</div>
        </div>

        <div class="mb-3">
          <label for="lensModel" class="form-label">Lens Model</label>
          <input
            name="lens"
            type="text"
            class="form-control"
            id="lensModel"
            placeholder="Enter your lens model"
            required
          />
          <div class="invalid-feedback">Please enter a lens model.</div>
        </div>

        <div class="d-flex justify-content-between">
          <div class="mb-3">
            <label for="aperture" class="form-label">Aperture</label>
            <select
              name="aperture"
              class="form-select form-control"
              id="aperture"
              required
            >
              <option value="" disabled selected>Select aperture</option>
              <option value="f/1.4">f/1.4</option>
              <option value="f/2.8">f/2.8</option>
              <option value="f/4">f/4</option>
              <option value="f/5.6">f/5.6</option>
              <option value="f/8">f/8</option>
            </select>
            <div class="invalid-feedback">Aperture required.</div>
          </div>

          <div class="mb-3">
            <label for="shutterSpeed" class="form-label">Shutter Speed</label>
            <select
              name="sutter_speed"
              class="form-select form-control"
              id="shutterSpeed"
              required
            >
              <option value="" disabled selected>Select shutter speed</option>
              <option value="1/1000">1/1000</option>
              <option value="1/500">1/500</option>
              <option value="1/250">1/250</option>
              <option value="1/125">1/125</option>
              <option value="1/60">1/60</option>
            </select>
            <div class="invalid-feedback">Shutter speed required.</div>
          </div>

          <div class="mb-3">
            <label for="iso" class="form-label">ISO</label>
            <select
              name="iso"
              class="form-select form-control"
              id="iso"
              required
            >
              <option value="" disabled selected>Select ISO</option>
              <option value="100">100</option>
              <option value="200">200</option>
              <option value="400">400</option>
              <option value="800">800</option>
              <option value="1600">1600</option>
            </select>
            <div class="invalid-feedback">ISO required.</div>
          </div>
        </div>
        <div class="text-end mt-4">
          <button
            type="button"
            class="btn btn-secondary me-2"
            id="cancelSubmit"
          >
            Cancel
          </button>
          <button type="submit" class="btn btn-secondary">Submit Photo</button>
        </div>
      </form>
    </div>

    <%- include('partials/footer') %>

    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"
      crossorigin="anonymous"
    ></script>
    <script>
      document.addEventListener("DOMContentLoaded", function () {
        const form = document.getElementById("artSubmitForm");

        form.addEventListener("submit", function (event) {
          event.preventDefault();
          let valid = validateForm();

          if (valid) {
            const formData = new FormData(form);

            // Log each key-value pair
            for (const [key, value] of formData.entries()) {
              console.log(key, value);
            }

            console.log(formData);
            $.ajax({
              type: "POST",
              url: "/sutter-space/create-art",
              data: formData,
              contentType: false,
              processData: false,
              success: function (response) {
                if (response.success) {
                  showToastify(response.message);
                } else {
                  showToastifyError(response.message);
                }
              },
              error: function () {
                showToast("An error occurred. Please try again.");
              },
            });
          }
        });
        function validateForm() {
          let isValid = true;

          const inputs = document.querySelectorAll(".form-control");

          inputs.forEach((input) => {
            if (!input.checkValidity()) {
              isValid = false;
              input.classList.add("is-invalid");
            } else {
              input.classList.remove("is-invalid");
            }
          });

          return isValid;
        }

        const sidebar = document.getElementById("sidebar");
        const overlay = document.getElementById("overlay");
        const openSidebarBtn = document.getElementById("openSidebar");
        const closeSidebarBtn = document.getElementById("closeSidebar");
        const cancelSubmitBtn = document.getElementById("cancelSubmit");

        openSidebarBtn.addEventListener("click", function () {
          sidebar.classList.add("active");
          overlay.classList.add("active");
        });

        closeSidebarBtn.addEventListener("click", function () {
          sidebar.classList.remove("active");
          overlay.classList.remove("active");
        });

        cancelSubmitBtn.addEventListener("click", function () {
          sidebar.classList.remove("active");
          overlay.classList.remove("active");
          resetForm();
        });

        function resetForm() {
          form.reset();
          inputs.forEach((input) => {
            input.classList.remove("is-invalid");
          });
          document.getElementById("imagePreview").style.display = "none";
        }

        overlay.addEventListener("click", function () {
          sidebar.classList.remove("active");
          overlay.classList.remove("active");
        });

        const photoUpload = document.getElementById("photoUpload");
        const imagePreview = document.getElementById("imagePreview");

        photoUpload.addEventListener("change", function () {
          const file = this.files[0];
          if (file) {
            const reader = new FileReader();
            reader.onload = function () {
              imagePreview.src = reader.result;
              imagePreview.style.display = "block";
            };
            reader.readAsDataURL(file);
          }
        });
      });
    </script>
  </body>
</html>
