<%- include('partials/head') %>

<body>
  <div class="screen-overlay"></div>
  <%- include('partials/aside') %>
  <main class="main-wrap">
    <header class="main-header navbar">
      <div class="col-search">
        <form class="searchform">
          <div class="input-group">
            <input
              list="search_terms"
              type="text"
              class="form-control"
              placeholder="Search term"
            />
            <button class="btn btn-light bg" type="button">
              <i class="material-icons md-search"></i>
            </button>
          </div>
          <datalist id="search_terms">
            <option value="Products"></option>
            <option value="New orders"></option>
            <option value="Apple iphone"></option>
            <option value="Ahmed Hassan"></option>
          </datalist>
        </form>
      </div>
      <div class="col-nav">
        <button
          class="btn btn-icon btn-mobile me-auto"
          data-trigger="#offcanvas_aside"
        >
          <i class="material-icons md-apps"></i>
        </button>
        <ul class="nav">
          <li class="nav-item">
            <a class="nav-link btn-icon" href="#">
              <i class="material-icons md-notifications animation-shake"></i>
              <span class="badge rounded-pill">3</span>
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link btn-icon darkmode" href="#">
              <i class="material-icons md-nights_stay"></i>
            </a>
          </li>
          <li class="nav-item">
            <a href="#" class="requestfullscreen nav-link btn-icon"
              ><i class="material-icons md-cast"></i
            ></a>
          </li>
          <li class="dropdown nav-item">
            <a
              class="dropdown-toggle"
              data-bs-toggle="dropdown"
              href="#"
              id="dropdownLanguage"
              aria-expanded="false"
              ><i class="material-icons md-public"></i
            ></a>
            <div
              class="dropdown-menu dropdown-menu-end"
              aria-labelledby="dropdownLanguage"
            >
              <a class="dropdown-item text-brand" href="#"
                ><img
                  src="assets/imgs/theme/flag-us.png"
                  alt="English"
                />English</a
              >
              <a class="dropdown-item" href="#"
                ><img
                  src="assets/imgs/theme/flag-fr.png"
                  alt="Français"
                />Français</a
              >
              <a class="dropdown-item" href="#"
                ><img
                  src="assets/imgs/theme/flag-jp.png"
                  alt="Français"
                />日本語</a
              >
              <a class="dropdown-item" href="#"
                ><img
                  src="assets/imgs/theme/flag-cn.png"
                  alt="Français"
                />中国人</a
              >
            </div>
          </li>
          <li class="dropdown nav-item">
            <a
              class="dropdown-toggle"
              data-bs-toggle="dropdown"
              href="#"
              id="dropdownAccount"
              aria-expanded="false"
            >
              <img
                class="img-xs rounded-circle"
                src="assets/imgs/people/avatar2.jpg"
                alt="User"
            /></a>
            <div
              class="dropdown-menu dropdown-menu-end"
              aria-labelledby="dropdownAccount"
            >
              <a class="dropdown-item" href="#"
                ><i class="material-icons md-perm_identity"></i>Edit Profile</a
              >
              <a class="dropdown-item" href="#"
                ><i class="material-icons md-settings"></i>Account Settings</a
              >
              <a class="dropdown-item" href="#"
                ><i class="material-icons md-account_balance_wallet"></i
                >Wallet</a
              >
              <a class="dropdown-item" href="#"
                ><i class="material-icons md-receipt"></i>Billing</a
              >
              <a class="dropdown-item" href="#"
                ><i class="material-icons md-help_outline"></i>Help center</a
              >
              <div class="dropdown-divider"></div>
              <a class="dropdown-item text-danger" href="#"
                ><i class="material-icons md-exit_to_app"></i>Logout</a
              >
            </div>
          </li>
        </ul>
      </div>
    </header>
    <section class="content-main">
      <div class="content-header">
        <div>
          <h2 class="content-title card-title">Order List</h2>
          <p>Lorem ipsum dolor sit amet.</p>
        </div>
        <div>
          <input
            type="text"
            placeholder="Search order ID"
            class="form-control bg-white"
          />
        </div>
      </div>
      <div class="card mb-4">
        <header class="card-header">
          <div class="row gx-3">
            <!-- <div class="col-lg-2 col-6 col-md-3">
              <select class="form-select">
                <option>Status</option>
                <option>Active</option>
                <option>Disabled</option>
                <option>Show all</option>
              </select>
            </div> -->
            <div class="col-lg-2 col-md-3 col-6">
              <select class="form-select" id="limitSelect">
                <option value="4" <%= limit === 4 ? 'selected' : '' %>>Show 4</option>
                <option value="8" <%= limit === 8 ? 'selected' : '' %>>Show 8</option>
                <option value="12" <%= limit === 12 ? 'selected' : '' %>>Show 12</option>
              </select>
            </div>
          </div>
        </header>
        <!-- card-header end// -->
        <div class="card-body">
          <div class="table-responsive">
            <%if(orders){%>
            <table class="table table-hover">
              <thead>
                <tr>
                  <th scope="col">Name</th>
                  <th scope="col">Email</th>
                  <th scope="col">Total</th>
                  <th scope="col">Status</th>
                  <th scope="col">Date</th>
                  <th scope="col" class="text-end"></th>
                </tr>
              </thead>
              <tbody>
                <% orders.forEach((order) => {%>
                <tr>
                  <td>
                    <b
                      ><%= order.userId.firstName + " " +
                      order.userId.lastName%></b
                    >
                  </td>
                  <td><%= order.userId.email %></td>
                  <td>₹ <%= order.totalPrice %></td>
                  <td>
                    <span class="badge rounded-pill alert-warning w-50"
                      ><%= order.orderStatus %></span
                    >
                  </td>
                  <td><%= new Date(order.placedAt).toDateString() %></td>
                  <td>
                    <a
                      href="/admin/orders/<%= order._id %>"
                      class="btn btn-md rounded font-sm"
                      >Detail</a
                    >
                  </td>
                </tr>
                <%})%>
              </tbody>
            </table>
            <%} else {%>
            <p>No orders</p>
            <%}%>
          </div>
          <!-- table-responsive //end -->
        </div>
        <!-- card-body end// -->
      </div>
      <!-- card end// -->
      <div class="pagination-area mt-30 mb-50">
        <nav aria-label="Page navigation example">
          <ul class="pagination justify-content-center">
            <% if (currentPage > 1) { %>
            <li class="page-item">
              <a
                class="page-link"
                href="?page=<%= currentPage - 1 %>&limit=<%= limit %>"
              >
                <i class="material-icons md-chevron_left"></i>
              </a>
            </li>
            <% } %> <% for (let i = 1; i <= totalPages; i++) { %>
            <li class="page-item <%= currentPage === i ? 'active' : '' %>">
              <a class="page-link" href="?page=<%= i %>&limit=<%= limit %>">
                <%= i %>
              </a>
            </li>
            <% } %> <% if (currentPage < totalPages) { %>
            <li class="page-item">
              <a
                class="page-link"
                href="?page=<%= currentPage + 1 %>&limit=<%= limit %>"
              >
                <i class="material-icons md-chevron_right"></i>
              </a>
            </li>
            <% } %>
          </ul>
        </nav>
      </div>
    </section>
    <!-- content-main end// -->
    <%- include('partials/footer') %>
    <script>
      document
        .getElementById("limitSelect")
        .addEventListener("change", function () {
          const selectedLimit = this.value; 
          const url = new URL(window.location.href);
    
          url.searchParams.set("limit", selectedLimit);
    
          window.location.href = url.toString();
        });
    </script>
  </main>
</body>
